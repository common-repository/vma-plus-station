var TouchButton=pc.createScript("touchButton");TouchButton.attributes.add("identifier",{type:"string",default:"button0",title:"Identifier",description:"A unique name for the button to refer to it by in the API. Will give a warning in browser tools if the name is not unique."}),TouchButton.attributes.add("vibration",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchButton.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.buttonStates[this.identifier]?console.warn("Touch button identifier already used, please use another for Entity: "+this.entity.name):(this._canVibrate=!!navigator.vibrate,this._setState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=void 0)})),this._setEvents("on"))},TouchButton.prototype._setEvents=function(t){this._state=!1,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchButton.prototype._onMouseDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onMouseUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation())},TouchButton.prototype._onTouchDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onTouchUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation()),t.event.preventDefault()},TouchButton.prototype._onPointerDown=function(){this._canVibrate&&0!==this.vibration&&navigator.vibrate(this.vibration),this._setState(!0)},TouchButton.prototype._onPointerUp=function(){this._setState(!1)},TouchButton.prototype._setState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};var TouchJoystick=pc.createScript("touchJoystick");TouchJoystick.attributes.add("identifier",{type:"string",default:"joystick0",title:"Idenitifier",description:"A unique name for the joystick to refer to it by in the API. Joysticks are also buttons so this will also be the name of button in the API. It will give a warning in browser tools if the name is not unique."}),TouchJoystick.attributes.add("type",{type:"string",default:"fixed",enum:[{"Fixed in place":"fixed"},{"Move to first touch and fixed":"relative"},{"Move to first touch and drags":"drag"}],title:"Type",description:"Set type of behavior for the joystick."}),TouchJoystick.attributes.add("baseEntity",{type:"entity",title:"Base Entity",description:"Image Element Entity that shows the base of the joystick."}),TouchJoystick.attributes.add("nubEntity",{type:"entity",title:"Nub Entity",description:"Image Element Entity that shows the nub (top) of the joystick."}),TouchJoystick.attributes.add("axisDeadZone",{type:"number",default:10,title:"Axis Dead Zone",description:"The number of UI units from the position of the Base Entity where input is not registered."}),TouchJoystick.attributes.add("axisRange",{type:"number",default:50,title:"Axis Range",description:"The number of UI units from the position of the Base Entity that the Nub Entity can move to and is the maximum range"}),TouchJoystick.attributes.add("hideOnRelease",{type:"boolean",default:!1,title:"Hide on Release",description:"Will only show the joystick when the user is using it and will hide it on touch end. This is commonly used if you don't want the joystick to block what's being shown on screen."}),TouchJoystick.attributes.add("positionOnRelease",{type:"string",default:"stay",enum:[{Stay:"stay"},{Original:"original"},{"Last start":"lastStart"}],title:"Position on Release",description:"Where to move the joystick on release and can help keep the screen tidy so that there are clear areas to show the game and arrange controls."}),TouchJoystick.attributes.add("vibrationPress",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchJoystick.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.sticks[this.identifier]?console.warn("Touch joystick identifier already used, please use another for Entity: "+this.entity.name):(this._originalLocalPosition=this.baseEntity.getLocalPosition().clone(),this._lastPointerDownPosition=new pc.Vec3,this._setAxisValues(0,0),this._inputDown=!1,this._pointerId=-1,this._canVibrate=!!navigator.vibrate,this._setButtonState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]=void 0)})),this._setEvents("on"))},TouchJoystick.prototype._setEvents=function(t){this._setAxisValues(0,0),this._pointerDown=!1,this._pointerId=-1,this.baseEntity.enabled=!this.hideOnRelease,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mousemove",this._onMouseMove,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchmove",this._onTouchMove,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchJoystick.__uiPos=new pc.Vec2,TouchJoystick.prototype.screenToUi=function(t){const i=TouchJoystick.__uiPos,o=this.app.graphicsDevice.canvas.clientWidth,e=this.app.graphicsDevice.canvas.clientHeight;return i.x=t.x/o,i.y=t.y/e,i.mulScalar(2).subScalar(1),i.y*=-1,i},TouchJoystick.prototype._onMouseDown=function(t){t.id=0,this._onPointerDown(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseMove=function(t){t.id=0,this._onPointerMove(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseUp=function(t){t.id=0,this._pointerDown&&t.stopPropagation(),this._onPointerUp(t)},TouchJoystick.prototype._onTouchDown=function(t){if(this._pointerDown)return;const i=this._pointerDown;t.id=t.touch.identifier,this._onPointerDown(t),!i&&this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onTouchMove=function(t){t.id=t.touch.identifier,this._onPointerMove(t),this._pointerDown&&t.stopPropagation(),t.event.preventDefault()},TouchJoystick.prototype._onTouchUp=function(t){this._pointerDown&&(t.id=t.touch.identifier,this._onPointerUp(t),t.stopPropagation()),t.event.preventDefault()},TouchJoystick.prototype._onPointerDown=function(t){const i=this.screenToUi(t);switch(this.type){case"drag":case"relative":this.baseEntity.setPosition(i.x,i.y,0),this.nubEntity.setLocalPosition(0,0,0),this._pointerDown=!0;break;case"fixed":this.nubEntity.setPosition(i.x,i.y,0),this._updateAxisValuesFromNub(),this._pointerDown=!0}this._pointerDown&&(this._canVibrate&&0!==this.vibrationPress&&navigator.vibrate(this.vibrationPress),this._pointerId=t.id?t.id:0,this._setButtonState(!0),this._lastPointerDownPosition.copy(this.baseEntity.getLocalPosition()),this.baseEntity.enabled=!0,this._onPointerMove(t))},TouchJoystick.__tempNubPos=new pc.Vec3,TouchJoystick.__tempBasePos=new pc.Vec3,TouchJoystick.prototype._onPointerMove=function(t){if(this._pointerDown&&this._pointerId==t.id){const i=this.screenToUi(t),o=this.axisRange*this.axisRange;this.nubEntity.setPosition(i.x,i.y,0);const e=TouchJoystick.__tempNubPos;e.copy(this.nubEntity.getLocalPosition());if(e.lengthSq()>=o){if("drag"===this.type){const t=e.length()-this.axisRange,i=TouchJoystick.__tempBasePos;i.copy(e),i.normalize().mulScalar(t),i.add(this.baseEntity.getLocalPosition()),this.baseEntity.setLocalPosition(i)}e.normalize().mulScalar(this.axisRange),this.nubEntity.setLocalPosition(e)}this._updateAxisValuesFromNub()}},TouchJoystick.prototype._onPointerUp=function(t){if(this._pointerDown&&this._pointerId==t.id){switch(this.nubEntity.setLocalPosition(0,0,0),this.hideOnRelease&&(this.baseEntity.enabled=!1),this.positionOnRelease){case"original":this.baseEntity.setLocalPosition(this._originalLocalPosition);break;case"lastStart":this.baseEntity.setLocalPosition(this._lastPointerDownPosition)}this._pointerId=-1,this._updateAxisValuesFromNub(),this._setButtonState(!1),this._pointerDown=!1}},TouchJoystick.prototype._updateAxisValuesFromNub=function(){const t=this.axisRange-this.axisDeadZone,i=this.nubEntity.getLocalPosition(),o=Math.sign(i.x),e=Math.sign(i.y),s=pc.math.clamp(Math.abs(i.x)-this.axisDeadZone,0,t)*o,n=pc.math.clamp(Math.abs(i.y)-this.axisDeadZone,0,t)*e;this._setAxisValues(s/t,n/t)},TouchJoystick.prototype._setAxisValues=function(t,i){window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]={x:t,y:i}),this.axisX=t,this.axisY=i},TouchJoystick.prototype._setButtonState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},onUpdate:function(t){return this.on("update",t),this},onComplete:function(t){return this.on("complete",t),this},onLoop:function(t){return this.on("loop",t),this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var Lookat=pc.createScript("lookat");Lookat.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),Lookat.prototype.initialize=function(){this.directionToCamera=new pc.Vec3(0,0,0),this.cameraEntity=window.globalPlayerCamera},Lookat.prototype.update=function(t){if(window.globalPlayerCamera){var e=this.entity.getPosition().clone().sub(window.globalPlayerCamera.getPosition()),o=this.entity.getPosition().clone().add(e);this.entity.lookAt(o,pc.Vec3.UP)}else this.entity.lookAt(pc.Vec3.ZERO,pc.Vec3.UP)};!function(){var t=new pc.Vec3;pc.RigidBodyComponentSystem.prototype.raycastFirstByTag=function(n,r,a){for(var e=Number.MAX_VALUE,i=null,s=this.app.systems.rigidbody.raycastAll(n,r),o=0;o<s.length;++o){var y=s[o];if(y.entity.tags.has(a)){t.sub2(y.point,n);var p=t.lengthSq();p<e&&(e=p,i=y)}}return i}}();var BtnDefaultBehavior=pc.createScript("btnDefaultBehavior");BtnDefaultBehavior.prototype.initialize=function(){const t=this.entity.button;t.on("hoverstart",this.onHoverStart,this),t.on("hoverend",this.onHoverEnd,this),t.on("click",this.onHoverEnd,this),this.on("disable",this.onHoverEnd,this)},BtnDefaultBehavior.prototype.onHoverStart=function(){this.entity.enabled&&(window.isUiButtonHover=!0,document.body.style.cursor="pointer")},BtnDefaultBehavior.prototype.onHoverEnd=function(){window.isUiButtonHover=!1,document.body.style.cursor="default"};var ExitBtn=pc.createScript("exitBtn");ExitBtn.prototype.initialize=function(){this.entity.button.on("click",this.onPress,this)},ExitBtn.prototype.onPress=function(){console.log("let me leave to ",VMA_Utility.getApiHost()),this.domainLink=VMA_Utility.getApiHost(),this.domainLink.includes("dev")||this.domainLink.includes("localhost")?this.exitLink="https://dev-web.virtual-space-market.com/user/":this.exitLink="https://vma-plus-station.virtual-space-market.com/user/",window.open(this.exitLink,"_self")},ExitBtn.prototype.update=function(t){};var ShowModal=pc.createScript("showModal");ShowModal.attributes.add("modal",{type:"entity"}),ShowModal.prototype.initialize=function(){this.entity.element.on(pc.EVENT_MOUSEDOWN,this.show,this),this.entity.element.on(pc.EVENT_TOUCHSTART,this.show,this)},ShowModal.prototype.show=function(){this.modal.enabled=!0};var HideModal=pc.createScript("hideModal");HideModal.attributes.add("modal",{type:"entity"}),HideModal.prototype.initialize=function(){this.entity.element.on(pc.EVENT_TOUCHEND,this.hide,this),this.entity.element.on(pc.EVENT_MOUSEDOWN,this.hide,this)},HideModal.prototype.hide=function(){this.modal.enabled=!1};var UiLoadingScreen=pc.createScript("uiLoadingScreen");UiLoadingScreen.prototype.initialize=function(){this.counterElement=document.getElementById("loaderCounter"),this.loadingBar=document.getElementById("progress-bar"),this.app.on("html-handler:htmlReady",this.initializeUI),this.on("destroy",(function(){this.app.off("html-handler:htmlReady",this.initializeUI)})),this.app.on("html-handler:loadingStatus",this.updateLoadingScreen),this.on("destroy",(function(){this.app.off("html-handler:loadingStatus",this.updateLoadingScreen)})),this.app.on("SceneManager:sceneChangeStart",this.showLoadingScreen),this.on("destroy",(function(){this.app.off("SceneManager:sceneChangeStart",this.showLoadingScreen)})),this.app.on("SceneManager:sceneChangeComplete",this.hideLoadingScreen),this.on("destroy",(function(){this.app.off("SceneManager:sceneChangeComplete",this.hideLoadingScreen)}))},UiLoadingScreen.prototype.initializeUI=function(){this.counterElement=document.getElementById("loaderCounter"),this.counterElement&&(this.counterElement.textContent="50/100")},UiLoadingScreen.prototype.updateLoadingScreen=function(e){var t=document.getElementById("progress-bar");t&&(value=Math.min(1,Math.max(0,e)),t.style.width=0+100*value+"%"),pc.platform.mobile},UiLoadingScreen.prototype.showLoadingScreen=function(){pc.platform.mobile?document.getElementById("application-splash-wrapper").style.display="block":document.getElementById("application-splash-wrapper").style.display="block"},UiLoadingScreen.prototype.hideLoadingScreen=function(){pc.platform.mobile?document.getElementById("application-splash-wrapper").style.display="none":document.getElementById("application-splash-wrapper").style.display="none"};var MobileOnly=pc.createScript("mobileOnly");MobileOnly.prototype.initialize=function(){this.entity.enabled=pc.platform.mobile},MobileOnly.prototype.update=function(e){};!function(){const t={},n={},o={buttons:{isPressed:function(t){return!!n[t]},wasPressed:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(!s&&e)},wasReleased:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(s&&!e)},wasTapped:function(n){if(this.wasReleased(n)){return Date.now()-t[n]<=200}return!1}},sticks:{}};o.buttonStates=n;pc.Application.getApplication().on("update",(()=>{for(const o of Object.keys(n)){const e=n[o];t[o]=e}})),window.touchJoypad=o}();var InfoButtonHandler=pc.createScript("infoButtonHandler");let isFree=!1;InfoButtonHandler.prototype.initialize=function(){this.entity;this.entity.element.on(pc.EVENT_TOUCHEND,this.onButtonClick,this),this.entity.element.on(pc.EVENT_MOUSEDOWN,this.onButtonClick,this),isFree=!0},InfoButtonHandler.prototype.onButtonClick=function(t){this.app.fire("infoButtonClicked",t),console.log("Info Button Pressed")};var PosterComponent=pc.createScript("posterComponent");PosterComponent.attributes.add("link",{type:"string",default:"",title:"Product purchase URL"}),PosterComponent.attributes.add("imagelink",{type:"string",default:"",title:"Product image link"}),PosterComponent.prototype.initialize=function(){this.entity.button.on("click",this.onPress,this)},PosterComponent.prototype.setData=function(t,e){this.imagelink=t,this.link=e;var n=this;0==e.length&&(this.entity.button.enabled=!1);var o=new Image;o.crossOrigin="anonymous",o.onload=function(){var t=new pc.Texture(n.app.graphicsDevice);t.setSource(o),n.entity.element.texture=t},o.src=t},PosterComponent.prototype.onPress=function(t){window.isPlayerLookingAround||this.link&&!Utilities.isModalVisible()&&window.open(this.link,"_blank")},PosterComponent.prototype.hideElement=function(){this.entity.enabled=!1};var PostersController=pc.createScript("postersController");PostersController.attributes.add("maxPosterCount",{type:"number",default:6,title:"Amount of posters in scene"}),PostersController.attributes.add("postersArray",{type:"entity",array:!0});var postersList=[];PostersController.prototype.initialize=function(){numberOfPosters=this.maxPosterCount;for(var e=1;e<=numberOfPosters;e++){var t="Poster"+e,r=document.getElementById(t+"_image"),s=document.getElementById(t+"_url");if(r){var o={image:r.innerText,url:s.innerText};console.log("Data from HTML element:",o),postersList.push(o)}else{o={image:"",url:""};console.log("Data is emty:",o),postersList.push(o)}}for(e=0;e<numberOfPosters;e++){var n=this.postersArray[e].script.posterComponent;postersList[e].image.length>0?n.setData(postersList[e].image,postersList[e].url):n.hideElement()}};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");window.location.origin.includes("launch.playcanvas")?a.src="":a.src=`${PLUGIN_URL}station-wide.png`,t.appendChild(a),a.onload=function(){t.style.display="block"};var n=document.createElement("div");n.id="progress-bar-container",t.appendChild(n);var o=document.createElement("div");o.id="progress-bar",n.appendChild(o)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){document.getElementById("application-splash-wrapper")}))}));var Utilities=pc.createScript("utilities");Utilities.isModalVisible=function(){try{return isModalShown,!0,isModalShown}catch(i){return!1,!1}};var Uihandler=pc.createScript("uihandler");Uihandler.attributes.add("bootStrapCss",{type:"asset",assetType:"css",title:"Bootsrap CSS Asset"}),Uihandler.attributes.add("css",{type:"asset",assetType:"css",title:"Common CSS Asset"}),Uihandler.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Uihandler.prototype.initialize=function(){this.initHtmlPopup(this.html,this.css,this.bootStrapCss),this.bindHtmlEvents(),this.bindPlayCanvasEvents()},Uihandler.prototype.initHtmlPopup=function(t,e,n){var o=document.createElement("style");if(document.head.appendChild(o),o.innerHTML=e.resource||"",n){var i=document.createElement("style");document.head.appendChild(i),i.innerHTML=n.resource||""}var a=document.createElement("div");a.classList.add("container"),a.innerHTML=t.resource||"",document.body.appendChild(a)},Uihandler.prototype.bindHtmlEvents=function(){let t=document.querySelector("#info-modal-container");function stopPropagation(t){t.stopPropagation()}t.addEventListener("mousedown",stopPropagation),t.addEventListener("click",stopPropagation),t.addEventListener("keydown",stopPropagation),t.addEventListener("wheel",stopPropagation),document.querySelector("#info-modal-close-btn").addEventListener("click",this.hideInfoModal)},Uihandler.prototype.bindPlayCanvasEvents=function(){this.app.on("infoButtonClicked",this.showInfoModal)},Uihandler.prototype.showInfoModal=function(){document.querySelector("#info-modal-container").style.display="flex"},Uihandler.prototype.hideInfoModal=function(){document.querySelector("#info-modal-container").style.display="none"};var AnimatedTexture=pc.createScript("animatedTexture");AnimatedTexture.attributes.add("materialAsset",{type:"asset",assetType:"material"}),AnimatedTexture.attributes.add("numFrames",{type:"number",default:1,description:"Number of frames to play before looping"}),AnimatedTexture.attributes.add("startFrame",{type:"number",default:0,description:"Frame to start animation from"}),AnimatedTexture.attributes.add("width",{type:"number",default:1,description:"Number of frames wide"}),AnimatedTexture.attributes.add("height",{type:"number",default:1,description:"Number of frames high"}),AnimatedTexture.attributes.add("frameRate",{type:"number",default:1,description:"Playback frames per second"}),AnimatedTexture.attributes.add("isLoop",{type:"boolean",default:!1,description:"Is looping enabled"}),AnimatedTexture.attributes.add("isReverse",{type:"boolean",default:!1,description:"Is animation played in reverse"}),AnimatedTexture.attributes.add("isBackAndForth",{type:"boolean",default:!1,description:"Is animation looped back in reverse"}),AnimatedTexture.attributes.add("entityDisable",{type:"entity",description:"Entity that will be disabled after animation ends. No loop only"}),AnimatedTexture.prototype.initialize=function(){this.onEnable(!0),this.on("state",this.onEnable,this)},AnimatedTexture.prototype.onEnable=function(t){t&&(this.app.fire("anim:texture:start",this.entity.tags),this.materialAsset&&(this.material=this.materialAsset.resource),this.stepDt=1/this.frameRate,this.timer=this.stepDt,this.frame=this.startFrame,this.step=this.isReverse?-1:1,this.uniform0=[0,0,0],this.uniform1=[0,0,0],this.updateMaterial(this.frame),this.isFinished=!1)},AnimatedTexture.prototype.finishLoop=function(){if(!this.isLoop&&!this.isBackAndForth)return this.app.fire("anim:texture:end",this.entity.tags),this.entityDisable&&(this.entityDisable.enabled=!1),!0;this.isBackAndForth?(this.frame-=this.step,this.step=-this.step):this.frame=this.startFrame},AnimatedTexture.prototype.update=function(t){if(this.isFinished)return;if(this.timer-=t,this.timer>0)return;let e=Math.abs(this.timer/this.stepDt);this.frame+=this.step*Math.floor(e+1),(this.frame>=this.numFrames+this.startFrame||this.frame<0)&&(this.isFinished=this.finishLoop(),this.isFinished)||(this.updateMaterial(this.frame),this.timer=this.stepDt-(e-Math.floor(e))*this.stepDt)},AnimatedTexture.prototype.updateMaterial=function(t){var e=1/this.width,i=1/this.height,s=t%this.width*e,a=Math.floor(t/this.width)*i,r=this.entity.render.meshInstances;this.uniform0[0]=e,this.uniform0[1]=0,this.uniform0[2]=s,this.uniform1[0]=0,this.uniform1[1]=i,this.uniform1[2]=a,r[0].setParameter("texture_diffuseMapTransform0",this.uniform0),r[0].setParameter("texture_diffuseMapTransform1",this.uniform1),r[0].setParameter("texture_emissiveMapTransform0",this.uniform0),r[0].setParameter("texture_emissiveMapTransform1",this.uniform1),r[0].setParameter("texture_opacityMapTransform0",this.uniform0),r[0].setParameter("texture_opacityMapTransform1",this.uniform1)};var ScrollingTexture=pc.createScript("scrollingTexture");ScrollingTexture.attributes.add("materialAsset",{type:"asset"}),ScrollingTexture.attributes.add("speed",{type:"vec2"}),ScrollingTexture.tmpVec2=new pc.Vec2,ScrollingTexture.tmpOffset=new pc.Vec2,ScrollingTexture.prototype.initialize=function(){this.materialAsset&&(this.material=this.materialAsset.resource)},ScrollingTexture.prototype.update=function(e){var t=ScrollingTexture.tmpVec2,i=ScrollingTexture.tmpOffset;t.set(this.speed.x,this.speed.y),t.scale(e),i.copy(this.material.diffuseMapOffset),i.add(t),this.material.diffuseMapOffset=i,this.material.opacityMapOffset=i,this.material.update()};var WaterScript=pc.createScript("waterScript");WaterScript.attributes.add("speed",{type:"vec2",default:[.1,.1],description:"Speed of the water movement (x, y)"}),WaterScript.prototype.initialize=function(){this.time=0},WaterScript.prototype.update=function(t){this.time+=t;var e=this.time*this.speed.x,i=this.time*this.speed.y,r=this.entity.render.meshInstances[0].material;r.normalMapOffset.set(e,i),r.update()};var currentSceneName,previousSceneName,SceneManager=pc.createScript("sceneManager");SceneManager.attributes.add("sceneRootEntity",{type:"entity"}),SceneManager.attributes.add("defaultScene",{type:"string"}),SceneManager.attributes.add("defaultSceneId",{type:"string"}),SceneManager.attributes.add("scenesMapData",{type:"json",array:!0,schema:[{name:"key",type:"string"},{name:"value",type:"string"}]}),SceneManager.prototype.initialize=function(){window.globalTextures=[],window.currentSceneId="";var e=document.getElementById("DefaultSceneName"),n=e?e.value:"";n&&n.length>0?this.changeSceneAdditiveByName(n):this.changeSceneAdditiveByName(this.defaultScene),this.mySceneMap=new Map(this.scenesMapData.map((e=>[e.key,e.value]))),this.initializeSceneLoadPromise()},SceneManager.prototype.initializeSceneLoadPromise=function(){window.sceneLoaded||(window.sceneLoaded=new Promise((e=>{window.resolveSceneLoaded=e})))},SceneManager.prototype.changeSceneAdditiveByName=function(e){window.sceneLoaded=null,this.initializeSceneLoadPromise(),this.app.fire("SceneManager:sceneChangeStart"),window.currentSceneName=e,this.unloadAssets("preload"+previousSceneName).then((()=>this.unloadAssets(previousSceneName))).then((()=>this.loadAssets("preload"+e))).then((()=>this.loadAssets(e))).then((()=>this.switchScene(e))).then((()=>{setTimeout(function(){this.app.fire("SceneManager:sceneChangeComplete")}.bind(this),1e3),window.resolveSceneLoaded(),previousSceneName=e})).catch((e=>{console.error("Scene change error:",e),this.app.fire("SceneManager:sceneChangeError",e)}))},SceneManager.prototype.changeSceneAdditiveByID=function(e){this.app.fire("SceneManager:sceneChangeStart"),window.currentSceneId=e,this.mySceneMap.has(e.toString().substring(0,2))?this.sceneName=this.mySceneMap.get(e.toString().substring(0,2)):(this.sceneName=this.defaultScene,window.currentSceneId=this.defaultSceneId),this.changeSceneAdditiveByName(this.sceneName)},SceneManager.prototype.loadAssets=function(e){return new Promise(((n,t)=>{var a=this.app.assets.findByTag(e),s=0,i=a.length;0!==i?a.forEach((e=>{e.ready((()=>{var e=++s/i;this.app.fire("html-handler:loadingStatus",e),s===a.length&&n()})),this.app.assets.load(e)})):n()}))},SceneManager.prototype.unloadAssets=function(e){return new Promise((n=>{var t=this.app.assets.findByTag(e);t.forEach((e=>{e.unload()}));var a=this.app.assets.findByTag("RemoveOnSceneChange");a.forEach((e=>{e.unload(),pc.app.assets.remove(e)})),this.destroyTextures(),n()}))},SceneManager.prototype.destroyTextures=function(){window.globalTextures.forEach((e=>{e.destroy()})),window.globalTextures=[]},SceneManager.prototype.switchScene=function(e){return new Promise(((n,t)=>{const a=this.app.scenes.find(e);this.sceneRootEntity.children.length>0&&this.sceneRootEntity.children.forEach((e=>{e.destroy()})),this.app.scenes.loadSceneHierarchy(e,((s,i)=>{s?t(new Error("Failed to load scene hierarchy: "+e)):(this.app.scenes.loadSceneSettings(a,(function(e){e&&console.error(e)})),i.reparent(this.sceneRootEntity),n())}))}))},SceneManager.prototype.checkSceneExists=function(e){let n=!1;try{n=this.mySceneMap.has(e.toString().substring(0,2))}catch(n){console.error(`SceneManager checkSceneExists(${e}) error: ${n}`)}return n};var CloudScript=pc.createScript("cloudScript");CloudScript.attributes.add("speed",{type:"vec2",default:[.1,.1],description:"Speed of the water movement (x, y)"}),CloudScript.prototype.initialize=function(){this.time=0,console.log("******************",this.entity.render.meshInstances),this.material=this.entity.render.meshInstances[0].material},CloudScript.prototype.update=function(t){this.time+=t;var e=this.time*this.speed.x,i=this.time*this.speed.y;this.material&&this.material.diffuseMapOffset.set(e,i),this.material&&this.material.emissiveMapOffset.set(e,i),this.material&&this.material.update()};var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("animEntity",{type:"entity",title:"Anim Entity"}),PlayerMovement.attributes.add("cameraEntity",{type:"entity",default:null}),PlayerMovement.attributes.add("speed",{type:"number",default:.09}),PlayerMovement.attributes.add("sprintSpeed",{type:"number",default:.18}),PlayerMovement.attributes.add("strafe",{type:"boolean",default:!1}),PlayerMovement.attributes.add("rotationSpeed",{type:"number",default:20,description:"Adjusts the sensitivity of turning around on strafe mode"}),PlayerMovement.attributes.add("rotateSpeed",{type:"number",default:100,description:"Adjusts the sensitivity of looking"}),PlayerMovement.attributes.add("isFlying",{type:"boolean",default:!1}),PlayerMovement.attributes.add("groundCheckHeight",{type:"number",default:.05,description:"the lenght of raycast to determinate if it is grounded"}),PlayerMovement.attributes.add("jumpForce",{type:"number",default:6e3,description:"Adjusts the strength of the jump"}),PlayerMovement.attributes.add("lerpTime",{type:"number",default:.2,description:"Adjusts the time it takes the character to turn around."}),PlayerMovement.attributes.add("blend",{type:"number",default:.5});let grounded=!0;PlayerMovement.prototype.initialize=function(){grounded=!0;var t=this.entity.findByName("PlayerCamera");this.cameraScript=t.script.cameraMovement,this.jumpInProgress=!1;var onContextMenu=()=>{this.app.keyboard._keymap={},this.app.keyboard._lastmap={}};addEventListener("focusout",onContextMenu),addEventListener("contextmenu",onContextMenu),this.on("destroy",(()=>{removeEventListener("contextmenu",onContextMenu),removeEventListener("focusout",onContextMenu)})),this.app.on("PlayerSettings:Strafe",this.onStrafeUpdate,this),this.on("destroy",(()=>{this.app.off("PlayerSettings:Strafe",this.onStrafeUpdate,this)})),this.app.on("PlayerSettings:Action",this.onUiAction,this),this.on("destroy",(()=>{this.app.off("PlayerSettings:Action",this.onUiAction,this)})),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyboardKey.bind(this,!0)),this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyboardKey.bind(this,!1)),this.animEntity.anim.on("Jump-end",this.onJumpEnd,this)},PlayerMovement.prototype.onJumpEnd=function(){this.jumpInProgress=!1},PlayerMovement.prototype.onKeyboardKey=function(t,e){isFree||(e.key!=pc.KEY_X||this.cheer_ui||(this.cheer=t),e.key!=pc.KEY_Z||this.clap_ui||(this.clap=t),e.key!=pc.KEY_SPACE||this.jump_ui||(this.jump=t))},PlayerMovement.prototype.onUiAction=function(t){const e=this[t+"_ui"],i=this[t];this[t+"_ui"]=!e,!e&&i||(this[t]=!i)},PlayerMovement.worldDirection=new pc.Vec3,PlayerMovement.tempDirection=new pc.Vec3;const forceUp=new pc.Vec3(0,9.8,0);PlayerMovement.prototype.postUpdate=function(t){this.animJump=!1,this.isGrounded();var e=this.app;let i=window.touchJoypad.sticks.joystick0,s=window.touchJoypad.buttons.isPressed("button0"),r=window.touchJoypad.buttons.isPressed("button1");this.isTurning&&this.turnAround();var n=PlayerMovement.worldDirection;n.set(0,0,0);var a=PlayerMovement.tempDirection,o=new pc.Vec3(this.cameraEntity.forward.x,0,this.cameraEntity.forward.z);o.normalize();var d=new pc.Vec3(-this.cameraEntity.right.x,0,-this.cameraEntity.right.z);d.normalize();var p=this.entity.up,y=0,h=0,u=0;if(this.app.keyboard.isPressed(pc.KEY_SHIFT)?sprint=!0:sprint=!1,(e.keyboard.isPressed(pc.KEY_W)||e.keyboard.isPressed(pc.KEY_UP)||i.y>0)&&(u+=sprint?2:1,this.strafe||this.startTurnAround(this.cameraScript.eulers.x)),(e.keyboard.isPressed(pc.KEY_S)||e.keyboard.isPressed(pc.KEY_DOWN)||i.y<0)&&(u-=sprint?2:1,this.strafe||this.startTurnAround(180+this.cameraScript.eulers.x)),(e.keyboard.isPressed(pc.KEY_A)||e.keyboard.isPressed(pc.KEY_LEFT)||i.x<0)&&(y+=sprint?2:1,this.strafe||this.startTurnAround(this.cameraScript.eulers.x)),(e.keyboard.isPressed(pc.KEY_D)||e.keyboard.isPressed(pc.KEY_RIGHT)||i.x>0)&&(y-=sprint?2:1,this.strafe||this.startTurnAround(this.cameraScript.eulers.x)),(this.app.keyboard.isPressed(pc.KEY_E)||s)&&(grounded||(this.isFlying=!0),h+=1),!this.app.keyboard.isPressed(pc.KEY_Q)&&!r||grounded||(h-=1),this.jump&&this.entity.rigidbody&&grounded&&(this.animJump=!0,this.entity.rigidbody.applyImpulse(0,this.jumpForce*t,0),grounded=!1),this.isFlying){var c=9.8*this.entity.rigidbody.mass;this.entity.rigidbody.applyForce(0,c,0),this.entity.rigidbody.linearVelocity=new pc.Vec3(0,0,0)}if(0!==y||0!==u||0!==h){n.add(a.copy(o).mulScalar(u)),this.strafe&&n.add(a.copy(d).mulScalar(y)),n.add(a.copy(p).mulScalar(h)),n.normalize();var l=new pc.Vec3(n.x*t,n.y*t,n.z*t),m=sprint?this.sprintSpeed:this.speed;if(l.normalize().scale(m),l.add(this.entity.getPosition()),0!==y&&!this.strafe){var g=i.x?Math.abs(i.x):1;this.cameraScript.eulers.x+=(this.rotateSpeed*y*g*t+360)%360}if(this.strafe&&(0!==y||0!==u)&&!n.equals(pc.Vec3.ZERO)){var f=Math.atan2(n.x,n.z)*pc.math.RAD_TO_DEG,b=new pc.Quat;b.setFromEulerAngles(0,f,0);var v=this.entity.getRotation(),P=new pc.Quat;P.slerp(v,b,t*this.rotationSpeed),this.entity.setRotation(P)}this.entity.rigidbody.teleport(l)}else this.isTurning=!1;this.animEntity&&(this.animEntity.script.animController.setXZ(-y,-u),this.animEntity.script.animController.setClap(this.clap),this.animEntity.script.animController.setCheer(this.cheer),this.animEntity.script.animController.setJump(this.animJump),this.animEntity.script.animController.setFly(this.isFlying))},PlayerMovement.prototype.startTurnAround=function(t){if(!this.isTurning){var e=new pc.Quat;e.setFromEulerAngles(0,t,0),this.startRotation=this.entity.getRotation().clone(),this.targetRotation=e,this.startTime=Date.now(),this.isTurning=!0}},PlayerMovement.prototype.onStrafeUpdate=function(t){this.strafe=t},PlayerMovement.prototype.turnAround=function(){var t=(Date.now()-this.startTime)/1e3,e=Math.min(t/this.lerpTime,1),i=(new pc.Quat).slerp(this.startRotation,this.targetRotation,e);this.entity.setRotation(i),e>=1&&(this.isTurning=!1)},PlayerMovement.prototype.isGrounded=function(t){grounded=!1;var e=this.entity.getPosition(),i=e.clone().add(new pc.Vec3(0,-this.groundCheckHeight,0));e=e.clone().add(new pc.Vec3(0,this.groundCheckHeight,0)),null!=this.app.systems.rigidbody.raycastFirstByTag(e,i,"ground")&&(grounded=!0,this.isFlying&&(this.isFlying=!1))},PlayerMovement.prototype.setIsFlying=function(t){this.isFlying=t},PlayerMovement.prototype.getIsFlying=function(){return this.isFlying};var CameraMovement=pc.createScript("cameraMovement");function screenDeltaToAngle(t){return t/60%360}function isTouchControlsActive(){let t=window.touchJoypad.buttonStates;return Object.values(t).some((t=>null!==t))}CameraMovement.attributes.add("avatarRender",{type:"entity"}),CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.attributes.add("touchLookSpeed",{type:"number",default:4,description:"Adjusts the sensitivity of looking around using touch"}),CameraMovement.attributes.add("maxPitchAngle",{type:"number",default:70,description:"Max rotation around x axis"}),CameraMovement.attributes.add("minPitchAngle",{type:"number",default:-70,description:"Min rotation around x axis"}),CameraMovement.attributes.add("povZoomSpeed",{type:"number",default:1,description:"Speed of camera movement based zoom (3rd person to 1st person)"}),CameraMovement.attributes.add("fovZoomSpeed",{type:"number",default:3,description:"Speed of FOV based zoom (1st person zoom in, 3rd person zoom out to ultra wide)"}),CameraMovement.attributes.add("maxZoomOut",{type:"number",default:8,description:"Max distance from camera to head"}),CameraMovement.attributes.add("maxZoomIn",{type:"number",default:.1,description:"Min distance from camera to head"}),CameraMovement.attributes.add("minFov",{type:"number",default:10}),CameraMovement.attributes.add("maxFov",{type:"number",default:120}),CameraMovement.attributes.add("tweenTime",{type:"number",default:.2,description:"Interpolation time between zoom levels"}),CameraMovement.attributes.add("pinchThreshold",{type:"number",default:50,description:"Pinch distance threshold"}),CameraMovement.attributes.add("pinchZoomSensivity",{type:"number",default:.05}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.entity.parent.getEulerAngles().x>=90?this.eulers.x=180-this.entity.parent.getEulerAngles().y:this.eulers.x=this.entity.parent.getEulerAngles().y,this.lastTouch=new pc.Vec2;var t=this.app;this.rayEnd=this.entity.parent.findByName("RaycastEndPoint"),t.mouse.on("mousemove",this.onMouseMove,this),t.mouse.on("mousedown",this.onMouseDown,this),t.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),pc.platform.mobile&&(t.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),t.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),t.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),t.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)),this.on("destroy",(function(){t.mouse.off("mousemove",this.onMouseMove,this),t.mouse.off("mousedown",this.onMouseDown,this),t.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),pc.platform.mobile&&(t.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),t.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),t.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),t.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))})),this.defaultFov=this.entity.camera.fov,this.entity.lookAt(this.entity.parent.getPosition())},CameraMovement.prototype.postUpdate=function(t){var e=this.entity.parent,o=this.eulers.x+180,i=this.eulers.y,n=new pc.Vec3(-i,o,0);e.setEulerAngles(n),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(e.getPosition())},CameraMovement.prototype.onMouseMove=function(t){window.isDialogActive||t.buttons[0]&&(this.eulers.x-=screenDeltaToAngle(this.mouseSpeed*t.dx),this.eulers.y+=screenDeltaToAngle(this.mouseSpeed*t.dy),this.limitPitchRotation())},CameraMovement.prototype.onTouchMove=function(t){if(!window.isDialogActive){var e=t.touches;if(1==e.length){let e=new pc.Vec2(t.touches[0].x,t.touches[0].y);this.eulers.x-=screenDeltaToAngle(this.touchLookSpeed*(e.x-this.lastTouch.x)),this.eulers.y+=screenDeltaToAngle(this.touchLookSpeed*(e.y-this.lastTouch.y)),this.lastTouch.set(e.x,e.y),this.limitPitchRotation()}else if(2==e.length){if(isTouchControlsActive())return;var o=this.getPinchDistance(e[0],e[1]),i=o-this.lastPinchDistance;if(!(Math.abs(i)>this.pinchThreshold))return;this.lastPinchDistance=o,this.zoomPov(i*this.pinchZoomSensivity)}}},CameraMovement.prototype.limitPitchRotation=function(){this.eulers.y>this.maxPitchAngle&&(this.eulers.y=this.maxPitchAngle),this.eulers.y<this.minPitchAngle&&(this.eulers.y=this.minPitchAngle)},CameraMovement.prototype.onMouseDown=function(t){},CameraMovement.prototype.getWorldPoint=function(){var t=this.entity.parent.getPosition(),e=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(t,e);return o&&!o.entity.tags.has("TriggerZone")?o.point:e},CameraMovement.prototype.onTouchStartEndCancel=function(t){var e=t.touches;1==e.length?this.lastTouch.set(e[0].x,e[0].y):2==e.length&&(this.lastPinchDistance=this.getPinchDistance(e[0],e[1]))},CameraMovement.prototype.getPinchDistance=function(t,e){var o=t.x-e.x,i=t.y-e.y;return Math.sqrt(o*o+i*i)},CameraMovement.prototype.onMouseWheel=function(t){this.zoomPov(t.wheel)},CameraMovement.prototype.zoomPov=function(t){if(this.entity.camera.fov!=this.defaultFov)return this.zoomFov(t);let e=this.rayEnd.localPosition.z;if(e<=this.maxZoomIn&&t>0)return this.isFirstPerson=!0,this.zoomFov(t);if(e>=this.maxZoomIn&&t<0&&(this.isFirstPerson=!1),e>=this.maxZoomOut&&t<0)return this.zoomFov(t);let o=e-t*this.povZoomSpeed;o>this.maxZoomOut?o=this.maxZoomOut:o<this.maxZoomIn&&(o=this.maxZoomIn),o<=this.maxZoomIn+.01?this.avatarRender&&(this.avatarRender.render.enabled=!1):this.avatarRender&&(this.avatarRender.render.enabled=!0),this.zoomPovTween&&this.zoomPovTween.stop(),this.zoomPovTween=this.rayEnd.tween(this.rayEnd.getLocalPosition()).to(new pc.Vec3(0,0,o),this.tweenTime,pc.SineOut).start()},CameraMovement.prototype.zoomFov=function(t){this.zoomFovTween&&this.zoomFovTween.stop();let e=this.entity.camera.fov-t*this.fovZoomSpeed;this.isFirstPerson?(e>this.defaultFov&&(e=this.defaultFov),e<this.minFov&&(e=this.minFov)):(e<this.defaultFov&&(e=this.defaultFov),e>this.maxFov&&(e=this.maxFov)),this.zoomFovTween=this.app.tween(this.entity.camera).to({fov:e},this.tweenTime,pc.SineOut).start()};var Player=pc.createScript("player");Player.attributes.add("micButton",{type:"entity"}),Player.attributes.add("userName",{type:"entity"}),Player.attributes.add("avatarImage",{type:"entity"}),Player.attributes.add("avatarRender",{type:"entity"}),Player.attributes.add("avatarCustomizable",{type:"boolean",default:!0}),Player.prototype.manualInitialize=function(t,e){if(this.initializePlayerData(t,e),e?(window.globalPlayerCamera=this.entity.findByName("PlayerCamera"),window.globalPlayerCamera.enabled=!0,window.globalPlayerCamera.script.cameraMovement.enabled=!0,this.entity.script.playerMovement.enabled=!0,this.entity.collision.enabled=!0,this.entity.tags.add("localPlayer"),window.isGuest="0"===t.userData.role,this.app.fire("Player:LogInStatusChanged",window.isGuest),window.isGuest||this.setupPlayerSetting(t)):t.userData.settings.listen("is_muted",((t,e)=>{this.micButton.script.muteButton.fire("MuteButton:OnMicMute",t)})),this.avatarImage){var a=isMobile?t.userData.avatarUrlMobile:t.userData.avatarUrlPc;(a=a||t.userData.avatarUrl)&&this.setImagesOnFace(this.avatarImage,a,t.userData.avatarUrl)}if(t.userData.settings.avatar_color){if(this.avatarCustomizable&&this.avatarRender.render.meshInstances[1]){var i=this.avatarRender.render.meshInstances[1],s=i.material.clone(),r=t.userData.settings.avatar_color;s.diffuse=function hexToPcColor(t){t=t.replace(/^#/,"");var e=parseInt(t.substring(0,2),16)/255,a=parseInt(t.substring(2,4),16)/255,i=parseInt(t.substring(4,6),16)/255;return new pc.Color(e,a,i)}(r),i.material=s,i.material.update()}}},Player.prototype.setImagesOnFace=function(t,e,a=null){var i=this;const s=new Image;let r=t.element.texture;t.element.opacity=0,t.element.useInput=!1,s.crossOrigin="anonymous";let n=null;s.onload=function(){n=new pc.Texture(i.app.graphicsDevice),n.setSource(s),t.element.fitMode=pc.FITMODE_CONTAIN,t.element.texture=n,t.element.opacity=1},s.onerror=function(){console.log("Error loading image:",e),a?(console.log("Trying fallback URL:",a),s.src=a,a=null):(t.element.texture=r,t.element.opacity=1)},s.src=e,t.on("destroy",(function(){n&&(n.destroy(),n=null)}))},Player.prototype.initializePlayerData=function(t,e){this.userName.element.text=t.userData.nickname,this.micButton.script.muteButton.manualInitialize(t.userData.settings.is_muted,e)},Player.prototype.setupPlayerSetting=function(t){var e;switch(this.app.fire("PlayerSettings:FrameLimit",t.userData.settings.fps,!1),t.userData.settings.graphics){case 0:e="Low";break;case 1:e="Medium";break;default:e="High"}this.app.fire("PlayerSettings:QualitySettings",e,!1),this.app.fire("PlayerSettings:MultimediaVolume",t.userData.settings.multi_media_volume,!1),this.app.fire("PlayerSettings:MultimediaMute",t.userData.settings.is_multi_media_muted,!1),this.app.fire("PlayerSettings:SFXVolume",t.userData.settings.sfx_volume,!1),this.app.fire("PlayerSettings:SFXMuted",t.userData.settings.is_sfx_muted,!1),this.app.fire("PlayerSettings:FirstPersonMode",t.userData.settings.is_first_person,!1),this.app.fire("PlayerSettings:Language",t.userData.settings.lang,!1),this.app.fire("PlayerSettings:AutoTranslate",t.userData.settings.autoTranslate,!1),this.app.fire("PlayerSettings:ChatOpen",t.userData.settings.is_chat_window_enabled,!1),this.app.fire("PlayerSettings:MicMuted",t.userData.settings.is_muted,!1);var a=t.userData.settings.is_horizontal_moving_instead_of_rotating??window.playerOptions.strafe;this.app.fire("PlayerSettings:Strafe",a,!1),this.app.fire("UI:Settings:FrameLimit",t.userData.settings.fps),this.app.fire("UI:Settings::QualitySettings",e),this.app.fire("UI:Settings::MultimediaVolume",t.userData.settings.multi_media_volume),this.app.fire("UI:Settings::MultimediaMuted",t.userData.settings.is_multi_media_muted),this.app.fire("UI:Settings::SFXVolume",t.userData.settings.sfx_volume),this.app.fire("UI:Settings::SFXMuted",t.userData.settings.is_sfx_muted),this.app.fire("UI:Settings::FirstPersonMode",t.userData.settings.is_first_person),this.app.fire("UI:Settings::Language",t.userData.settings.lang),this.app.fire("UI:Settings::AutoTranslate",t.userData.settings.autoTranslate),this.app.fire("UI:Settings::ChatOpen",t.userData.settings.is_chat_window_enabled),this.app.fire("UI:Settings::MicMuted",t.userData.settings.is_muted),this.app.fire("UI:Settings::Strafe",t.userData.settings.is_horizontal_moving_instead_of_rotating)};var NetworkAnimator=pc.createScript("networkAnimator");NetworkAnimator.attributes.add("interval",{type:"number",default:.1,description:"How often data should be updated, 0.1 Execute function 10 times per second"}),NetworkAnimator.attributes.add("animEntity",{type:"entity",title:"Anim Entity"}),NetworkAnimator.prototype.initialize=function(){this.counter=0,this.sessionId="notAssigned",this.previousAnimX=this.animEntity.script.animController.getX(),this.previousAnimZ=this.animEntity.script.animController.getZ(),this.previousClap=this.animEntity.script.animController.getClap(),this.previousTowel=this.animEntity.script.animController.getCheer(),this.previousJump=this.animEntity.script.animController.getJump(),this.previousIsFlying=this.animEntity.script.animController.getFly()},NetworkAnimator.prototype.initializeNetId=function(t,i){this.sessionId=i,t.onChange((()=>{if(this.tween&&this.tween.stop(),this.sessionId!=pc.app.room.sessionId){if(this.animX=t.animX,this.animZ=t.animZ,this.towel=t.towel,this.clap=t.clap,this.jump=t.jump,this.isFlying=t.isFlying,void 0===this.animX)return;this.animEntity.script.animController.getX()==this.animX&&this.animEntity.script.animController.getZ()==this.animZ||this.animEntity.script.animController.setXZ(this.animX,this.animZ),this.animEntity.script.animController.getClap()!=this.clap&&this.animEntity.script.animController.setClap(this.clap),this.animEntity.script.animController.getCheer()!=this.towel&&this.animEntity.script.animController.setCheer(this.towel),this.animEntity.script.animController.getJump()!=this.jump&&this.animEntity.script.animController.setJump(this.jump),this.animEntity.script.animController.getFly()!=this.isFlying&&this.animEntity.script.animController.setFly(this.isFlying)}}))},NetworkAnimator.prototype.update=function(t){if(this.counter+=t,this.counter>=this.interval){if(this.sessionId===pc.app.room.sessionId&&(this.animEntity.script.animController.getX()!=this.previousAnimX||this.animEntity.script.animController.getZ()!=this.previousAnimZ||this.animEntity.script.animController.getClap()!=this.previousClap||this.animEntity.script.animController.getCheer()!=this.previousTowel||this.animEntity.script.animController.getJump()!=this.previousJump||this.animEntity.script.animController.getFly()!=this.previousIsFlying)){var i=this.animEntity.script.animController.getX(),n=this.animEntity.script.animController.getZ(),s=this.animEntity.script.animController.getClap(),e=this.animEntity.script.animController.getCheer(),r=this.animEntity.script.animController.getJump(),o=this.animEntity.script.animController.getFly();pc.app.room.send("updateAnimation",{animX:i,animZ:n,clap:s,jump:r,towel:e,isFlying:o}),this.previousAnimX=i,this.previousAnimZ=n,this.previousClap=s,this.previousTowel=e,this.previousJump=r,this.previousIsFlying=o}this.counter=0}};var AnimController=pc.createScript("animController");AnimController.attributes.add("animationAssets",{type:"json",array:!0,title:"Base Animation Assets ",schema:[{name:"stateName",title:"State Name",type:"string"},{name:"asset",title:"Aseet",type:"asset",assetType:"animation"}]}),AnimController.attributes.add("upperBodyAnimationAssets",{type:"json",array:!0,title:"UpperBody Animation Assets",schema:[{name:"stateName",title:"State Name",type:"string"},{name:"asset",title:"Aseet",type:"asset",assetType:"animation"}]}),AnimController.attributes.add("humanRig",{type:"boolean",default:!1}),AnimController.attributes.add("upperBodyBlend",{type:"number",default:.5,description:"blending value to upper body mask"}),AnimController.attributes.add("towel",{type:"entity"}),AnimController.prototype.initialize=function(){this.strafe=!1,this.animX=0,this.animZ=0,this.clap=!1,this.cheer=!1,this.jump=!1,this.isFlying=!1,this.animCompoment=this.entity.anim;for(var t=0;t<this.animationAssets.length;++t){var e=this.animationAssets[t];this.entity.anim.assignAnimation(e.stateName,e.asset.resource)}this.animCompoment.baseLayer.weight=1-this.upperBodyBlend,this.animCompoment.baseLayer.blendType=pc.ANIM_LAYER_OVERWRITE,this.upperBodyMask={"RootNode/metarig/spine/spine.001":{children:!0}},this.lowerBodyMask={"RootNode/metarig/spine":{children:!1},"RootNode/metarig/spine/thigh.L":{children:!0},"RootNode/metarig/spine/thigh.R":{children:!0}},this.upperBodyLayer=this.animCompoment.addLayer("UpperBody",this.upperBodyBlend,this.upperBodyMask,pc.ANIM_LAYER_ADDITIVE);for(t=0;t<this.upperBodyAnimationAssets.length;++t){e=this.upperBodyAnimationAssets[t];this.upperBodyLayer.assignAnimation(e.stateName,e.asset.resource)}this.animCompoment.on("Clap-started",this.clapAnimationStarted,this),this.app.on("PlayerSettings:Strafe",this.onStrafeUpdate,this),this.on("destroy",(()=>{this.app.off("PlayerSettings:Strafe",this.onStrafeUpdate,this)}))},AnimController.prototype.setXZ=function(t,e){this.animX==t&&this.animZ==e||(this.animX=t,this.animZ=e,this.applyLocomotionAnimation())},AnimController.prototype.applyLocomotionAnimation=function(){if(0!==this.animZ||this.strafe&&0!==this.animX){var t=Math.abs(this.animZ)>1||Math.abs(this.animX)>1;if(this.isFlying){var e=t?"Fly_ForwardSprint":"Fly_Forward";this.animCompoment.baseLayer.activeState!==e&&this.animCompoment.baseLayer.transition(e,.4)}else{var i=t?"Sprint":"Walk";this.animCompoment.baseLayer.activeState!==i&&this.animCompoment.baseLayer.transition(i,.4)}}else this.isFlying?this.animCompoment.baseLayer.transition("Fly_Idle",.4):this.animCompoment.baseLayer.transition("Idle",.4)},AnimController.prototype.getX=function(){return this.animX},AnimController.prototype.getZ=function(){return this.animZ},AnimController.prototype.setClap=function(t){this.clap==t||this.cheer||(this.clap=t,this.clap?"Clap"!==this.upperBodyLayer.activeState&&(this.animCompoment.fire("Clap-started"),this.animCompoment.baseLayer.mask=this.lowerBodyMask,this.animCompoment.baseLayer.weight=1,this.upperBodyLayer.weight=1,this.upperBodyLayer.transition("Clap",.4)):(this.animCompoment.fire("Clap-ended"),"Idle"!==this.upperBodyLayer.activeState&&"Cheer"!==this.upperBodyLayer.activeState&&(this.animCompoment.baseLayer.weight=1,this.upperBodyLayer.weight=0,this.animCompoment.baseLayer.mask=null,this.upperBodyLayer.transition("Idle",.4))))},AnimController.prototype.getClap=function(){return this.clap},AnimController.prototype.setJump=function(t){if(this.jump!=t&&(this.jump=t,!this.isFlying)){"Jump"!==this.animCompoment.baseLayer.activeState&&this.jump&&this.animCompoment.baseLayer.transition("Jump",.4);var onJumpEnd=function(){this.applyLocomotionAnimation(),this.animCompoment.off("Jump-end",onJumpEnd)};this.animCompoment.on("Jump-end",onJumpEnd,this)}},AnimController.prototype.getJump=function(){return this.jump},AnimController.prototype.setCheer=function(t){this.cheer==t||this.clap||(this.cheer=t,this.cheer?"Cheer"!==this.upperBodyLayer.activeState&&(this.towel&&(this.towel.enabled=!0),this.animCompoment.baseLayer.mask=this.lowerBodyMask,this.animCompoment.baseLayer.weight=1,this.upperBodyLayer.weight=1,this.upperBodyLayer.transition("Cheer",.4)):(this.towel&&(this.towel.enabled=!1),"Idle"!==this.upperBodyLayer.activeState&&"Clap"!==this.upperBodyLayer.activeState&&(this.animCompoment.baseLayer.weight=1,this.upperBodyLayer.weight=0,this.animCompoment.baseLayer.mask=null,this.upperBodyLayer.transition("Idle",.4))))},AnimController.prototype.setFly=function(t){this.isFlying!=t&&(this.isFlying=t,this.applyLocomotionAnimation())},AnimController.prototype.getFly=function(){return this.isFlying},AnimController.prototype.getCheer=function(){return this.cheer},AnimController.prototype.onStrafeUpdate=function(t){this.strafe=t};var NetworkTransform=pc.createScript("networkTransform");NetworkTransform.attributes.add("interval",{type:"number",default:.1,description:"How often data should be updated, 0.1 Execute function 10 times per second"}),NetworkTransform.prototype.initialize=function(){this.counter=0,this.notOwnedTargetPosition=new pc.Vec3(0,0,0),this.previousPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.previousRotation=this.entity.getRotation().y,this.targetRotation=this.entity.getLocalRotation().y,this.sessionId="notAssigned"},NetworkTransform.prototype.initializeNetId=function(t,i){this.sessionId=i,t.onChange((()=>{this.tween&&this.tween.stop(),this.sessionId!=pc.app.room.sessionId&&(this.notOwnedTargetPosition=new pc.Vec3(0,0,0),this.notOwnedTargetPosition.x=t.x,this.notOwnedTargetPosition.y=t.y,this.notOwnedTargetPosition.z=t.z,this.rotationY=t.rotationY,this.animX=t.animX,this.animZ=t.animZ,this.towel=t.towel,this.clap=t.clap,this.jump=t.jump,this.moveTween=this.entity.tween(this.entity.getLocalPosition()).to(this.notOwnedTargetPosition,this.interval+.4,pc.Linear),this.moveTween.start(),this.entity.getLocalEulerAngles().y!=this.rotationY&&(this.rotateTween=this.entity.tween(this.entity.getLocalEulerAngles()).rotate(new pc.Vec3(0,this.rotationY,0),this.interval+.4,pc.Linear),this.rotateTween.start()))}))},NetworkTransform.prototype.update=function(t){this.counter+=t,this.targetPosition=this.entity.getPosition(),this.targetRotation=this.entity.getLocalRotation().y,this.counter>=this.interval&&this.sessionId===pc.app.room.sessionId&&(this.targetPosition.equals(this.previousPosition)&&!this.targetRotation!=this.previousRotation||(pc.app.room.send("updatePosition",{x:this.targetPosition.x,y:this.targetPosition.y,z:this.targetPosition.z}),this.yaw=this.getYaw(this.entity.getRotation()),pc.app.room.send("updateRotation",{rotationY:this.yaw}),this.previousPosition=this.targetPosition.clone(),this.previousRotation=this.targetRotation),this.counter=0);var i=new pc.Vec3;NetworkTransform.prototype.getYaw=function(t){var o=i;return t.transformVector(pc.Vec3.FORWARD,o),Math.atan2(-o.x,-o.z)*pc.math.RAD_TO_DEG}};var CharactereSfx=pc.createScript("charactereSfx");CharactereSfx.attributes.add("animEntity",{type:"entity",title:"Anim Entity"}),CharactereSfx.prototype.initialize=function(){this.isTabFocused=!0,this.animEntity.anim.on("Clap-started",this.clapAnimationStarted,this),this.animEntity.anim.on("Clap-ended",this.clapAnimationEnded,this),this.entity.on("destroy",this.clapAnimationEnded,this),this.bindVisibilityChangeEvent=this.handleVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.bindVisibilityChangeEvent,!1),this.on("destroy",(()=>{document.removeEventListener("visibilitychange",this.bindVisibilityChangeEvent,!1)}))},CharactereSfx.prototype.clapAnimationStarted=function(){var t=this;(AudioManager.instance.canPlaySFX()||this.entity.tags.has("localPlayer"))&&(this.clapInterval=setInterval((function(){var i=function getRandomName(t,i,a){return t+(Math.floor(Math.random()*(a-i+1))+i)}("Clap",1,2);t.entity.sound.volume=100,t.entity.sound.play(i)}),400))},CharactereSfx.prototype.clapAnimationEnded=function(){this.clapInterval&&(clearInterval(this.clapInterval),this.clapInterval=null)},CharactereSfx.prototype.handleVisibilityChange=function(){document.hidden?(this.isTabFocused=!1,this.clapInterval&&(clearInterval(this.clapInterval),this.clapInterval=null)):(this.isTabFocused=!0,"Clap"==this.animEntity.anim.activeState&&this.clapAnimationStarted())};var MuteButton=pc.createScript("muteButton");MuteButton.attributes.add("mutedImage",{type:"asset",assetType:"texture"}),MuteButton.attributes.add("unMutedImage",{type:"asset",assetType:"texture"}),MuteButton.prototype.manualInitialize=function(t,e){this.onMicMute(t),this.bindOnMicMute=this.onMicMute.bind(this),this.on("MuteButton:OnMicMute",this.bindOnMicMute),this.on("destroy",(function(){this.off("MuteButton:OnMicMute",this.bindOnMicMute)})),e&&(this.entity.element.texture=this.mutedImage.resource,this.app.on("AgoraVoice:mute",this.bindOnMicMute),this.on("destroy",(function(){this.app.off("AgoraVoice:mute",this.bindOnMicMute)})),this.bindTalkable=this.talkable.bind(this),this.app.on("TriggerZoneCommunication:voice:join",this.bindTalkable),this.on("destroy",(function(){this.app.off("TriggerZoneCommunication:voice:join",this.bindTalkable)})),this.bindUntalkable=this.untalkable.bind(this),this.app.on("TriggerZoneCommunication:voice:leave",this.bindUntalkable),this.on("destroy",(function(){this.app.off("TriggerZoneCommunication:voice:leave",this.bindUntalkable)})))},MuteButton.prototype.onMicMute=function(t){t?channelParameters.localAudioTrack&&(this.entity.element.texture=this.mutedImage.resource):channelParameters.localAudioTrack&&(this.entity.element.texture=this.unMutedImage.resource)},MuteButton.prototype.talkable=function(){VMA_Utility.isGuestUser()||window.playerOptions.is_muted||(this.entity.element.texture=this.unMutedImage.resource)},MuteButton.prototype.untalkable=function(){this.entity.element.texture=this.mutedImage.resource};var AudioManager=pc.createScript("audioManager");AudioManager.attributes.add("maxNumberOfSoundInstances",{type:"number",default:200}),AudioManager.prototype.initialize=function(){AudioManager.instance=this,this.currentSFX=0,this.app.on("SceneManager:sceneChangeComplete",this.resetCounter),AudioManager.instance.on("AudioManager:addAudio",this.addAudio),AudioManager.instance.on("AudioManager:removeAudio",this.removeAudio),this.on("destroy",(function(){this.app.off("SceneManager:sceneChangeComplete",this.resetCounter),AudioManager.instance.off("AudioManager:addAudio",this.addAudio),AudioManager.instance.off("AudioManager:removeAudio",this.removeAudio)}))},AudioManager.prototype.canPlaySFX=function(){return this.currentSFX<=this.maxNumberOfSoundInstances},AudioManager.prototype.resetCounter=function(){this.currentSFX=0},AudioManager.prototype.addAudio=function(){this.currentSFX+=1},AudioManager.prototype.removeAudio=function(){this.currentSFX-=1};var MainMenuController=pc.createScript("mainMenuController");MainMenuController.prototype.initialize=function(){this.startX=this.entity.getLocalPosition().x,this.targetX=this.startX-180,this.duration=.5,this.isSlidingLeft=!1,this.app.on("PlayCanvasUI:OpenMenu",this.slideLeft,this),this.app.on("PlayCanvasUI:CloseMenu",this.slideRight,this)},MainMenuController.prototype.slideLeft=function(){this.slideTo(this.targetX)},MainMenuController.prototype.slideRight=function(){this.slideTo(this.startX)},MainMenuController.prototype.slideTo=function(t){this.currentTween&&this.currentTween.stop();var i=this.entity.getLocalPosition(),e=this.entity.tween(i).to({x:t,y:i.y,z:i.z},1,pc.SineOut);e.start(),this.currentTween=e};var EventTrigger=pc.createScript("eventTrigger");EventTrigger.attributes.add("eventName",{type:"string"}),EventTrigger.prototype.initialize=function(){this.entity.element.on(pc.EVENT_TOUCHEND,this.onButtonClick,this),this.entity.element.on(pc.EVENT_MOUSEDOWN,this.onButtonClick,this)},EventTrigger.prototype.onButtonClick=function(t){this.app.fire(this.eventName,t)};var StopPropogating=pc.createScript("stopPropogating");StopPropogating.prototype.initialize=function(){this.entity.element.on(pc.EVENT_MOUSEDOWN,(function(t){t.stopPropagation()})),this.entity.element.on(pc.EVENT_TOUCHEND,(function(t){t.stopPropagation()}))};var ToggleUibutton=pc.createScript("toggleUibutton");ToggleUibutton.attributes.add("eventName",{type:"string"}),ToggleUibutton.attributes.add("actionName",{type:"string"}),ToggleUibutton.attributes.add("color",{type:"rgba"}),ToggleUibutton.prototype.initialize=function(){this.toggled=!1,this.isTouchEvent=!1,this.entity.element.on(pc.EVENT_TOUCHEND,(function(t){this.isTouchEvent=!0,this.onButtonClick(t)}),this),this.entity.element.on(pc.EVENT_MOUSEDOWN,(function(t){this.isTouchEvent||this.onButtonClick(t),setTimeout(function(){this.isTouchEvent=!1}.bind(this),0)}),this),this.app.on("CharacterManager:SwapCharacter",this.onSwapCharacter,this)},ToggleUibutton.prototype.onSwapCharacter=function(){this.entity.element.color=new pc.Color(1,1,1),this.toggled=!1},ToggleUibutton.prototype.onButtonClick=function(t){this.toggled=!this.toggled,this.toggled?this.entity.element.color=this.color:this.entity.element.color=new pc.Color(1,1,1),this.app.fire(this.eventName,this.actionName)};var CharacterManager=pc.createScript("characterManager");CharacterManager.attributes.add("characterTemplates",{type:"asset",array:!0,assetType:"template"}),CharacterManager.prototype.initialize=function(){this.currentCharacterId=0,this.currentCharacterEntity,this.app.on("SceneManager:sceneChangeComplete",this.spawnCharacter,this),this.app.on("CharacterManager:SwapCharacter",this.swapCharacter,this)},CharacterManager.prototype.spawnCharacter=function(){var t=this.getEntitiesWithTag("SpawnPoint");this.currentCharacterEntity&&this.currentCharacterEntity.destroy();var r=this.characterTemplates[this.currentCharacterId].resource.instantiate();if(this.currentCharacterEntity=r,t.length>0){var a=t[0].getPosition(),e=t[0].getRotation();r.setPosition(a),r.setRotation(e)}this.app.root.addChild(r),r.script.playerMovement.enabled=!0;var i=this.getEntitiesWithTag("MainCamera",r);i.length>0&&(i[0].enabled=!0)},CharacterManager.prototype.swapCharacter=function(){if(this.currentCharacterEntity){var t=this.currentCharacterEntity.getPosition(),r=this.currentCharacterEntity.getRotation();this.wasFlying=this.currentCharacterEntity.script.playerMovement.getIsFlying(),this.currentCharacterEntity.destroy()}this.currentCharacterId=this.currentCharacterId+1,this.currentCharacterId>=this.characterTemplates.length&&(this.currentCharacterId=0);var a=this.characterTemplates[this.currentCharacterId].resource.instantiate();a.rigidbody.linearFactor=new pc.Vec3(0,0,0),this.currentCharacterEntity=a,a.setPosition(t),a.setRotation(r),a.script.playerMovement.setIsFlying(this.wasFlying),this.app.root.addChild(a),setTimeout((()=>{var t=this.getEntitiesWithTag("MainCamera",a);t.length>0&&(t[0].enabled=!0),a.script.playerMovement.enabled=!0,a.rigidbody.linearFactor=new pc.Vec3(1,1,1)}),100)},CharacterManager.prototype.getEntitiesWithTag=function(t,r=this.app.root){return r.findByTag(t)};var FakeSceneStarter=pc.createScript("fakeSceneStarter");FakeSceneStarter.prototype.initialize=function(){this.app.fire("SceneManager:sceneChangeComplete"),this.hideLoadingScreen()},FakeSceneStarter.prototype.hideLoadingScreen=function(){pc.platform.mobile?document.getElementById("application-splash-wrapper").style.display="none":document.getElementById("application-splash-wrapper").style.display="none"};